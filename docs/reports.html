<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarlang Reports & Suggestions</title>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- Config -->
    <script src="js/config.js"></script>
    <!-- Utils -->
    <script src="js/utils/utils.js"></script>
    <!-- Services -->
    <script src="js/services/supabase-service.js"></script>
    <!-- Components -->
    <script src="js/components/reports-app.js"></script>
    
    <link rel="stylesheet" href="css/jarlang-common.css">
    <style>
        /* Page-specific styles */
        .reports-list {
            margin-top: 32px;
        }
        .report-item {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            transition: box-shadow 0.2s;
        }
        .report-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .report-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 12px;
        }
        .report-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .report-type.bug {
            background: #fee;
            color: #c53030;
        }
        .report-type.feature {
            background: #e6fffa;
            color: #234e52;
        }
        .report-type.improvement {
            background: #fef5e7;
            color: #744210;
        }
        .report-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin: 8px 0;
        }
        .report-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 12px;
        }
        .report-description {
            color: #555;
            line-height: 1.5;
        }
        .report-actions {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e1e5e9;
            display: flex;
            gap: 8px;
        }
        .report-flagged {
            opacity: 0.6;
            background: #fff5f5;
            border: 1px solid #fed7d7;
        }
        .report-flagged .report-title::after {
            content: " [FLAGGED]";
            color: #c53030;
            font-size: 0.8em;
            font-weight: normal;
        }
        .report-hidden {
            display: none;
        }
        .reports-controls {
            margin-top: 20px;
            margin-bottom: 12px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
            background: #ffffff;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.9em;
        }
        .control-group select {
            width: 200px;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: #fff;
        }
        .sort-buttons {
            display: flex;
            gap: 8px;
        }
        .toggle {
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .toggle.active {
            background: #667eea;
            color: white;
        }
        .slider-group {
            margin-top: 12px;
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background: #fff;
            padding: 12px 16px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
        }
        .slider-group input[type="range"] {
            width: 100%;
        }
        .slider-label {
            font-size: 0.85em;
            color: #666;
        }
        .moderation-notice {
            background: #fffbeb;
            border: 1px solid #fed7aa;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
            color: #92400e;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="syntax.html">Syntax</a>
        <a href="stdlib.html">Standard Library</a>
        <a href="testlib.html">Test Library</a>
        <a href="index.html">How-To Guide</a>
        <a href="story.html">Story of Jarlang</a>
        <a href="reports.html">Reports & Suggestions</a>
        <a href="downloads.html">Downloads</a>
    </nav>

    <div id="app">
        <div class="container">
            <aside class="sidebar">
                <h3>Quick Actions</h3>
                <ul>
                    <li><a href="#submit-report">Submit Report</a></li>
                    <li><a href="#view-reports">View Reports</a></li>
                    <li><a href="#feature-requests">Feature Requests</a></li>
                    <li><a href="#bug-reports">Bug Reports</a></li>
                </ul>
            </aside>

            <main class="main-content">
                <div class="page-header">
                    <h1>üõ°Ô∏è Reports & Suggestions</h1>
                    <img src="jarlang_resources/jarknight_final_glaze.png" alt="JarKnight Mascot" class="mascot-img" />
                </div>

                    <div v-if="!supabaseConfigured" class="alert alert-error">
                        <strong>‚ö†Ô∏è Demo Mode:</strong> Supabase is not configured. Reports won't be saved. 
                        <a href="QUICK_SETUP.md" style="color: #721c24; text-decoration: underline;">See setup guide</a>
                    </div>
                    
                    <div v-if="alert.show" :class="['alert', alert.type]">
                        {{ alert.message }}
                    </div>

                <section class="form-section" id="submit-report">
                    <h2>Submit a Report or Suggestion</h2>
                    <p>Help improve Jarlang by reporting bugs, suggesting features, or sharing ideas!</p>
                    
                    <form @submit.prevent="submitReport">
                        <div class="form-group">
                            <label for="type">Report Type</label>
                            <select v-model="form.type" id="type" required>
                                <option value="">Select type...</option>
                                <option value="bug">üêõ Bug Report</option>
                                <option value="feature">‚ú® Feature Request</option>
                                <option value="improvement">üöÄ Improvement Suggestion</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="title">Title</label>
                            <input 
                                v-model="form.title" 
                                type="text" 
                                id="title" 
                                placeholder="Brief description of the issue or suggestion"
                                required
                                maxlength="100"
                            />
                        </div>

                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea 
                                v-model="form.description" 
                                id="description" 
                                placeholder="Provide detailed information about the bug, feature request, or improvement..."
                                required
                                maxlength="1000"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="contact">Email (Optional)</label>
                            <input 
                                v-model="form.contact" 
                                type="email" 
                                id="contact" 
                                placeholder="your.email@example.com (for follow-up)"
                            />
                        </div>

                        <button type="submit" class="btn" :disabled="submitting">
                            {{ submitting ? 'Submitting...' : 'Submit Report' }}
                        </button>
                    </form>
                </section>

                <section class="reports-list" id="view-reports">
                    <h2>Recent Reports & Suggestions</h2>

                    <div class="reports-controls">
                        <div class="control-group">
                            <label for="report-type-filter">Type</label>
                            <select id="report-type-filter" v-model="filterType">
                                <option v-for="type in filterOptions" :key="type" :value="type">
                                    {{ type }}
                                </option>
                            </select>
                        </div>
                        <div class="control-group">
                            <span>Order</span>
                            <div class="sort-buttons">
                                <button type="button" class="toggle" :class="{ 'active': sortOrder === 'desc' }" @click="sortOrder = 'desc'">
                                    Newest ‚Üí Oldest
                                </button>
                                <button type="button" class="toggle" :class="{ 'active': sortOrder === 'asc' }" @click="sortOrder = 'asc'">
                                    Oldest ‚Üí Newest
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label for="reports-slider">Browse reports</label>
                        <input
                            id="reports-slider"
                            type="range"
                            :min="0"
                            :max="sliderMax"
                            step="1"
                            v-model.number="sliderOffset"
                            :disabled="sliderMax === 0"
                        />
                        <div class="slider-label">{{ sliderLabel }}</div>
                    </div>
                    
                    <div v-if="flaggedCount > 0" class="moderation-notice">
                        <strong>‚ö†Ô∏è Content Moderation:</strong> {{ flaggedCount }} report(s) have been flagged and are hidden pending review.
                    </div>
                    
                    <div v-if="loading" class="loading">
                        Loading reports...
                    </div>
                    
                    <div v-else-if="!supabaseConfigured" class="loading">
                        <strong>Demo Mode:</strong> Configure Supabase to see and save reports.
                        <br><a href="QUICK_SETUP.md" style="color: #667eea;">View setup guide ‚Üí</a>
                    </div>
                    
                    <div v-else-if="visibleReports.length === 0" class="loading">
                        {{ reports.length === 0 ? 'No reports yet. Be the first to contribute!' : 'All reports are currently under review.' }}
                    </div>
                    
                    <div v-else>
                        <div v-for="report in visibleReports" :key="report.id" 
                             :class="['report-item', { 'report-flagged': report.flagged }]">
                            <div class="report-header">
                                <span :class="['report-type', report.type]">{{ report.type }}</span>
                            </div>
                            <div class="report-title">{{ report.title }}</div>
                            <div class="report-meta">
                                Submitted {{ formatDate(report.created_at) }}
                            </div>
                            <div class="report-description">{{ report.description }}</div>
                            <div class="report-actions">
                                <button v-if="!report.flagged" 
                                        @click="flagReport(report)" 
                                        class="btn-small danger"
                                        :disabled="report.flagging">
                                    {{ report.flagging ? 'Flagging...' : 'üö© Flag as Inappropriate' }}
                                </button>
                                <span v-if="report.flagged" class="btn-small" style="color: #c53030;">
                                    ‚ö†Ô∏è Flagged for Review
                                </span>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // Initialize the Reports Vue.js application
        const { createApp } = Vue;
        createApp(window.ReportsApp).mount('#app');
    </script>
</body>
</html>